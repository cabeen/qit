<?xml version = '1.0' encoding = 'ISO-8859-1' ?>
<project name="qit-plugin" default="dist">

  <property name="name" value="my-qit-plugin"/>
  <property name="version" value="1.0"/>
  <property environment="env"/>
  
  <target name="buildinfo">
    <tstamp>
        <format 
           property="builtat" 
           pattern="MM/dd/yyyy hh:mm aa" 
           timezone="America/New_York"
        />
    </tstamp>        

    <exec executable="svnversion" outputproperty="svnversion"/>
    <exec executable="whoami" outputproperty="whoami"/>
    <exec executable="uname" outputproperty="buildsystem">
      <arg value="-a"/>
    </exec>

    <mkdir dir="dist" />
    <propertyfile 
      file="dist/${name}.properties"
      comment=" This file is automatically generated to document the build">
      <entry key="time" value="${builtat}"/>
      <entry key="revision" value="${svnversion}"/>
      <entry key="builder" value="${whoami}"/>
      <entry key="version" value="${version}"/>
      <entry key="system" value="${buildsystem}"/>
    </propertyfile>
  </target>

  <path id="classpath">
    <fileset dir="${env.QIT_DIR}/lib/jars">
       <include name="**/*.jar" />
    </fileset>
    <fileset dir="${env.QIT_DIR}/lib/jogamp-2.3.2/jar">
      <include name="**/*.jar" />
    </fileset>
  </path>

  <target name="init" > 
    <mkdir dir="build" />
    <mkdir dir="build/classes" />
  </target>

  <target name="unpack" depends="init"></target>

  <target name="compile" depends="unpack">
    <javac 
      srcdir="src" 
      destdir="build/classes" 
      classpathref="classpath"  
      excludes="test**"
      target="1.7" 
      source="1.7" 
      debug="on" 
      debuglevel="lines,vars,source"
      includeantruntime="false"/>
  </target>

  <target name="build" depends="compile">
    <jar jarfile="build/${name}.jar" >
      <fileset dir="build/classes" />
      <manifest>
        <attribute name="Author" value="Your Name" />
      </manifest>
    </jar>
  </target>

  <target name="dist" depends="build,buildinfo">
    <mkdir dir="dist" />
    <copy file="build/${name}.jar" tofile="dist/${name}.jar"/>
  </target>

  <target name="install" depends="dist">
    <mkdir dir="${user.home}/.qit/plugins" />
    <copy file="dist/${name}.properties" tofile="${user.home}/.qit/plugins/${name}.properties"/>
    <copy file="dist/${name}.jar" tofile="${user.home}/.qit/plugins/${name}.jar"/>
  </target>

  <target name="clean">
    <delete dir="build" />
  </target>
</project>
